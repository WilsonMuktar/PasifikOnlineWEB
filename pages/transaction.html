<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <link rel="apple-touch-icon" sizes="76x76" href="../assets/img/pasifikonline.png">
  <link rel="icon" type="image/png" href="../assets/img/pasifikonline.png">
  <title>
    PASIFIK-ONLINE
  </title>
  <link href="../assets/css/main.css" rel="stylesheet" />
<link rel="stylesheet" href="../assets/vendor/select2/select2.min.css">
  <!--     Fonts and icons     -->
  <link href="https://fonts.googleapis.com/css?family=Open+Sans:300,400,600,700" rel="stylesheet" />
  <!-- Nucleo Icons -->
  <link href="../assets/css/nucleo-icons.css" rel="stylesheet" />
  <link href="../assets/css/nucleo-svg.css" rel="stylesheet" />
  <!-- Font Awesome Icons -->
  <script src="../assets/js/plugins/fontawesome.js" crossorigin="anonymous"></script>
  <link href="../assets/css/nucleo-svg.css" rel="stylesheet" />
  <!-- CSS Files -->
  <link id="pagestyle" href="../assets/css/argon-dashboard.css?v=2.0.4" rel="stylesheet" />
</head>

<body class="g-sidenav-show   bg-gray-100">
<!-- The Modal -->
<div id="myModal" class="modal">
  <!-- Modal content -->
  <div class="modal-content">
    <span class="close">&times;</span>
  </div>
</div>
<div class="min-height-300 bg-primary position-absolute w-100"></div>
<aside class="sidenav bg-white navbar navbar-vertical navbar-expand-xs border-0 border-radius-xl my-3 fixed-start ms-4 " id="sidenav-main">
  <div class="sidenav-header">
    <i class="fas fa-times p-3 cursor-pointer text-secondary opacity-5 position-absolute end-0 top-0 d-none d-xl-none" aria-hidden="true" id="iconSidenav"></i>
    <a class="navbar-brand m-0" href="../index.html" target="_blank">
      <img src="../assets/img/pasifikonline.png" class="navbar-brand-img h-100" alt="main_logo">
      <span class="me-1 font-weight-bold">PASIFIK-ONLINE</span>
    </a>
  </div>
  <hr class="horizontal dark mt-0">
  <div class="collapse navbar-collapse  w-auto " id="sidenav-collapse-main" style="height:82%;">
    <!-- NAV SIDEBAR using main.js to load -->
  </div>
  <div>
    <ul class="navbar-nav">
      <li  id="logout_btn" class="nav-item">
        <a href="" class="nav-link text-muted" style="margin-left: 15%;" data-i18n-key="sign_out">
          <div class="icon icon-shape icon-sm border-radius-md text-center me-2 d-flex align-items-center justify-content-center">
            <i class="ni text-info text-sm opacity-10"></i>
          </div>
          <span class="nav-link-text ms-1" style="color:#FF0000" data-i18n-key="sign_out">Sign Out</span>
        </a>
      </li>
    </ul>
  </div>
</aside>
<main class="main-content position-relative border-radius-lg ">
  <!-- Navbar -->
  <nav class="navbar navbar-main navbar-expand-lg px-0 mx-4 shadow-none border-radius-xl " id="navbarBlur" data-scroll="false">
    <div class="container-fluid py-1 px-3">
      <nav aria-label="breadcrumb">
        <ol class="breadcrumb bg-transparent mb-0 pb-0 pt-1 px-0 me-sm-6 me-5">
          <li class="breadcrumb-item text-sm"><a class="opacity-5 text-white" href="javascript:;" data-i18n-key="breadcrumb_pages">Pages</a></li>
          <li class="breadcrumb-item text-sm text-white active" aria-current="page" data-i18n-key="breadcrumb_transaction">Transactions</li>
        </ol>
        <h6 class="font-weight-bolder text-white mb-0" data-i18n-key="heading_transaction">Transactions</h6>
      </nav>
      <div class="collapse navbar-collapse mt-sm-0 mt-2 me-md-0 me-sm-4" id="navbar">
        <div class="ms-md-auto pe-md-3 d-flex align-items-center">
          <div class="input-group">
            <!--span class="input-group-text text-body"><i class="fas fa-search" aria-hidden="true"></i></span>
            <input type="text" class="form-control" placeholder="Type here..."-->
          </div>
        </div>
        <ul class="navbar-nav  justify-content-end">
          <li class="nav-item dropdown pe-2 d-flex align-items-center">
            <div class="d-flex px-2 py-1" style="margin-top: 30px;"><div><img src="../assets/img/avatar/avatar-5.jpg" class="avatar avatar-sm me-3" alt="user1"></div>
              <div class="d-flex flex-column justify-content-center"><h6 id="account_name" class="mb-0 text-sm" data-i18n-key="account_name"></h6>
                <p id="account_roles" class="text-xs text-secondary mb-0" data-i18n-key="account_roles"></p></div></div>
          </li>
        </ul>
      </div>
    </div>
  </nav>
  <!-- End Navbar -->
  <div class="container-fluid py-4">
    <div class="row">
      <div class="col-12">
        <div class="card mb-4">
          <div class="card-header pb-0">
            <h6 data-i18n-key="transaction_table">Transaction table</h6>
            <div id="filters" style="display: none;">
              <input name="filter_transaction_start_date" class="form-control" type="date" value="">
              <input name="filter_transaction_end_date" class="form-control" type="date" value="">
              <select class="form-control" name="filter_transaction_type">
                <option disabled selected value="">--Select TransactionType--</option>
                <option value="Purchase" data-i18n-key="purchase">Purchase</option>
                <option value="Sale" data-i18n-key="sale">Sale</option>
                <option value="Return" data-i18n-key="return">Return</option>
                <option value="DebtCollect" data-i18n-key="debt_collect">DebtCollect</option>
                <option value="Tax" data-i18n-key="tax">Tax</option>
                <option value="Salary" data-i18n-key="salary">Salary</option>
                <option value="ColdStorage" data-i18n-key="cold_storage">Cold Storage</option>
              </select>
              <select class="form-control" name="filter_payment_type">
                <option disabled selected value="">--Select PaymentType--</option>
                <option value="CASH">CASH</option>
                <option value="DEBT">DEBT</option>
              </select>
              <select class="form-control" name="filter_buyer"></select>
              <select class="form-control" name="filter_seller"></select>
              <select class="form-control" name="filter_vessel"></select>
              <select class="form-control" name="filter_trip"></select>
              <select class="form-control" name="filter_product"></select>
              <button class="form-control bg-gradient-success text-bolder" onclick="applyTransactionFilters()">APPLY</button>
            </div>
            <ul class="nav-list">
              <div style="display: flex;">
                <h id="filter_button" data-i18n-key="filter" style="margin-right: 10px;">Filter</h>
                <h id="print_button" data-i18n-key="print" style="margin-right: 10px;">Print</h>
              </div>
              <li><span onclick="openPopup('Add Transaction','')" >&plus;</span></li>
            </ul>
          </div>
          <div class="card-body px-0 pt-0 pb-2">
            <div class="table-responsive p-0">
              <table id="transaction_table" class="table align-items-center mb-0">
                <thead><tr>
                  <th hidden class="text-uppercase text-secondary text-xxs font-weight-bolder opacity-7" data-i18n-key="transaction_id">Transaction ID</th>
                  <th class="text-uppercase text-secondary text-xxs font-weight-bolder opacity-7" data-i18n-key="product_id">Product ID</th>
                  <th class="text-uppercase text-secondary text-xxs font-weight-bolder opacity-7" data-i18n-key="buyer">Buyer</th>
                  <th class="text-uppercase text-secondary text-xxs font-weight-bolder opacity-7" data-i18n-key="seller">Seller</th>
                  <th class="text-uppercase text-secondary text-xxs font-weight-bolder opacity-7 ps-2" data-i18n-key="date">Date</th>
                  <th class="text-center text-uppercase text-secondary text-xxs font-weight-bolder opacity-7" data-i18n-key="type">Type</th>
                  <th class="text-uppercase text-secondary text-xxs font-weight-bolder opacity-7" data-i18n-key="total">Total</th>
                  <th class="text-uppercase text-secondary text-xxs font-weight-bolder opacity-7" data-i18n-key="quantity">Quantity</th>
                  <th class="text-uppercase text-secondary text-xxs font-weight-bolder opacity-7" data-i18n-key="quantity">Unit Price</th>
                  <th class="text-uppercase text-secondary text-xxs font-weight-bolder opacity-7" data-i18n-key="vessel_id">Vessel ID</th>
                  <th class="text-uppercase text-secondary text-xxs font-weight-bolder opacity-7" data-i18n-key="trip_id">Trip ID</th>
                  <th class="text-uppercase text-secondary text-xxs font-weight-bolder opacity-7" data-i18n-key="payment_type">Payment Type</th>
                  <th class="text-uppercase text-secondary text-xxs font-weight-bolder opacity-7" data-i18n-key="payment_status">Payment Status</th>
                  <th class="text-center text-uppercase text-secondary text-xxs font-weight-bolder opacity-7" data-i18n-key="actions">Actions</th>
                </tr></thead>
                <tbody>
                <tr class="datagrid__row vertical-animation">
                  <td><span><div class="datagrid__loader" style="width: 90%;"></div></span></td>
                  <td><span><div class="datagrid__loader" style="width: 80%;"></div></span></td>
                  <td><span><div class="datagrid__loader" style="width: 100%;"></div></span></td>
                  <td><span><div class="datagrid__loader" style="width: 100%;"></div></span></td>
                  <td><span><div class="datagrid__loader" style="width: 100%;"></div></span></td>
                  <td><span><div class="datagrid__loader" style="width: 100%;"></div></span></td>
                  <td><span><div class="datagrid__loader" style="width: 100%;"></div></span></td>
                  <td><span><div class="datagrid__loader" style="width: 100%;"></div></span></td>
                  <td><span><div class="datagrid__loader" style="width: 100%;"></div></span></td>
                  <td><span><div class="datagrid__loader" style="width: 100%;"></div></span></td>
                </tr>
                </tbody>
              </table>
            </div>
          </div>
        </div>
      </div>
    </div>
    <footer class="footer pt-3  ">
      <div class="container-fluid">
        <div class="row align-items-center justify-content-lg-between">
          <div class="col-lg-6 mb-lg-0 mb-4">
            <div class="copyright text-center text-sm text-muted text-lg-start">
              PASIFIK-ONLINE© <script>
              document.write(new Date().getFullYear())
            </script>
            </div>
          </div>
          <div class="col-lg-6">
            <ul class="nav nav-footer justify-content-center justify-content-lg-end">
              <!--li class="nav-item">
                <a href="https://www.creative-tim.com" class="nav-link text-muted" target="_blank">Creative Tim</a>
              </li>
              <li class="nav-item">
                <a href="https://www.creative-tim.com/presentation" class="nav-link text-muted" target="_blank">About Us</a>
              </li>
              <li class="nav-item">
                <a href="https://www.creative-tim.com/blog" class="nav-link text-muted" target="_blank">Blog</a>
              </li>
              <li class="nav-item">
                <a href="https://www.creative-tim.com/license" class="nav-link pe-0 text-muted" target="_blank">License</a>
              </li-->
            </ul>
          </div>
        </div>
      </div>
    </footer>
  </div>
</main>
<div class="fixed-plugin">
  <a class="fixed-plugin-button text-dark position-fixed px-3 py-2">
    <i class="fa fa-cog py-2"> </i>
  </a>
  <div class="card shadow-lg" id="right-side-navbar" hidden></div>
</div>
<!-- JS -->
<script src="../assets/vendor/jquery/jquery-3.2.1.min.js"></script>
<script src="../assets/js/main/config.js"></script>
<script src="../assets/js/main/main.js"></script>
<script src="../assets/js/main/auth/login.js"></script>
<script>
  // FILTER
  function applyTransactionFilters(){
    newURL = window.location.href.split("?")[0]+"?a="
    filter_transaction_type = document.querySelector('select[name="filter_transaction_type"]')
    filter_payment_type = document.querySelector('select[name="filter_payment_type"]')
    filter_buyer = document.querySelector('select[name="filter_buyer"]')
    filter_seller = document.querySelector('select[name="filter_seller"]')
    filter_product = document.querySelector('select[name="filter_product"]')
    filter_trip = document.querySelector('select[name="filter_trip"]')
    filter_vessel = document.querySelector('select[name=filter_vessel]')
    filter_transaction_start_date = document.querySelector('input[name=filter_transaction_start_date]')
    filter_transaction_end_date = document.querySelector('input[name=filter_transaction_end_date]')

    if (filter_transaction_type.value != ""){
      newURL += "&transaction_type="+filter_transaction_type.value
    }
    if (filter_payment_type.value!=""){
      newURL += "&payment_type="+filter_payment_type.value
    }
    if (filter_buyer.value!=""){
      newURL += "&buyer_id="+filter_buyer.value
    }
    if (filter_seller.value!=""){
      newURL += "&seller_id="+filter_seller.value
    }
    if (filter_product.value!=""){
      newURL += "&product_id="+filter_product.value
    }
    if (filter_trip.value!=""){
      newURL += "&trip_id="+filter_trip.value
    }
    if (filter_vessel.value != ""){
      newURL += "&vessel_id="+filter_vessel.value
    }
    if (filter_transaction_start_date.value != "") {
      newURL += "&transaction_date_from="+filter_transaction_start_date.value.replace("T00:00:00Z")
    }
    if (filter_transaction_end_date.value != "") {
      newURL += "&transaction_date_to="+filter_transaction_end_date.value
    }
    window.location.replace(newURL)
  }
  $("#filter_button").click(function(){
      if ( $("#filters").css("display") == "flex"){
        return
      }
      $("#filters").css("display","flex");
      MAKE_REQUEST("GET", vessel_api_url, "", true, function(response) {
        if (response instanceof Error) {
          alert("Add Catch get vessel list failed!")
          return
        }
        data = response.data;
        options = "<option disabled selected value data-i18n-key='select_vessel'> -- Select Vessel -- </option>"
        for (i = 0; i < data.length; i++) {
          options += `<option value="${data[i].vessel_id}">${data[i].vessel_name}</option>`
        }
        document.querySelector('select[name="filter_vessel"]').innerHTML = options
      })
      MAKE_REQUEST("GET", trip_api_url, "", true, function(response) {
        if (response instanceof Error) {
          alert("Add Catch get trip list failed!")
          return
        }
        data = response.data;
        options = "<option disabled selected value data-i18n-key=\"select_trip\"> -- Select Trip -- </option>"
        for (i = 0; i < data.length; i++) {
          options += `<option value="${data[i].trip_id}">${data[i].trip_name}</option>`
        }
        document.querySelector('select[name="filter_trip"]').innerHTML = options
      })
      MAKE_REQUEST("GET", product_api_url, "", true, function(response) {
        if (response instanceof Error) {
          alert("Add Catch get product list failed!")
          return
        }
        data = response.data;
        options = "<option disabled selected value data-i18n-key='select_product'> -- Select Product -- </option>"
        for (i = 0; i < data.length; i++) {
          options += `<option value="${data[i].product_id}">${data[i].product_name}</option>`
        }
        document.querySelector('select[name="filter_product"]').innerHTML = options
      })
      MAKE_REQUEST("GET", people_api_url, "", true, function(response) {
        if (response instanceof Error) {
          alert("Update trip get people list failed!");
          return;
        }
        ddata = response.data;
        options = ""
        for (i = 0; i < ddata.length; i++) {
          options += `<option value="${ddata[i].person_id}">${str(ddata[i].first_name)} ${str(ddata[i].last_name)}</option>`;
        }
        document.querySelector('select[name="filter_buyer"]').innerHTML = reorderSelectOptions(
                "<option disabled selected value data-i18n-key='select_buyer'> -- Select Buyer -- </option>" + options, data.captain_id);
        document.querySelector('select[name="filter_seller"]').innerHTML = reorderSelectOptions(
                "<option disabled selected value data-i18n-key='select_seller'> -- Select Seller -- </option>" + options, data.captain_id);
      });
      $(document).ready(function() {
        $('#filter_vessel').select2();
        $('#filter_trip').select2();
        $('#filter_product').select2();
        $('#filter_buyer').select2();
        $('#filter_seller').select2();
      });
  });

  $("#print_button").click(function(){
    if (window.location.href.includes("buyer_id=") && window.location.href.includes("seller_id=")) {
      window.location.href = window.location.href.replace("transaction.html", "bill.html")
    } else {
      alert("Silahkan Filter dan pilih buyer and seller, sebelum print")
    }
  });

  // Get the query string part of the URL
  // ?transaction_date_from=&transaction_date_to=&transaction_type=&product_id=&seller_id=&buyer_id=&vessel_id=&trip_id=&payment_type=
  const queryString = window.location.search;
  const urlParams = new URLSearchParams(queryString);
  var extraParams = ""
  urlParams.forEach((value, key) => {
    if (value != "") {
      if (extraParams == "") {
        extraParams += `?${key}=${value}`
      } else {
        extraParams += `&${key}=${value}`
      }
    }
  });
  currentYear = new Date().getFullYear()
  startYear = currentYear+"-01-01"
  endYear = currentYear+"-12-31"
  if (queryString.includes("transaction_date_from") || queryString.includes("transaction_date_to")) {} else {
    if (extraParams == "") {
      extraParams += `?transaction_date_from=${startYear}&transaction_date_to=${endYear}`
    } else {
      extraParams += `&transaction_date_from=${startYear}&transaction_date_to=${endYear}`
    }
  }

  // retrieve Transaction table
  MAKE_REQUEST("GET", transaction_api_url+extraParams, "", true,function(resp){
    if (resp instanceof Error) {
      console.log(resp);
    } else {
      processTransactionTable(resp)
    }
  })
</script>
<!--   Core JS Files   -->
<script src="../assets/js/core/popper.min.js"></script>
<script src="../assets/js/core/bootstrap.min.js"></script>
<script src="../assets/js/plugins/perfect-scrollbar.min.js"></script>
<script src="../assets/js/plugins/smooth-scrollbar.min.js"></script>
<script>
  var win = navigator.platform.indexOf('Win') > -1;
  if (win && document.querySelector('#sidenav-scrollbar')) {
    var options = {
      damping: '0.5'
    }
    Scrollbar.init(document.querySelector('#sidenav-scrollbar'), options);
  }
</script>
<!-- Control Center for Soft Dashboard: parallax effects, scripts for the example pages etc -->
<script src="../assets/js/argon-dashboard.min.js?v=2.0.4"></script>
<script src="../assets/vendor/select2/select2.min.js"></script>
</body>

</html>
